version: '2'
services:

#Reverse Proxy and LetsEncrypt
  traefik:
    container_name: traefik
    image: traefik:alpine
    restart: always
    networks:
      - srv
    ports:
      - 80:80
      - 443:443
    volumes:
      - /apps/traefik/traefik.toml:/traefik.toml
      - /var/run/docker.sock:/var/run/docker.sock
      - /apps/traefik/acme.json:/acme.json

#Dokuwiki
  wiki:
    container_name: dokuwiki
    image: mprasil/dokuwiki:2018-04-22b
    restart: always
    networks:
      - srv
    ports:
      - "8082:80"
    volumes:
      - /apps/wiki/data/:/dokuwiki/data
      - /apps/wiki/conf/:/dokuwiki/conf
      - /apps/wiki/lib/plugins/:/dokuwiki/lib/plugins
      - /apps/wiki/lib/tpl/:/dokuwiki/lib/tpl
      - /apps/wiki/logs/:/dokuwiki/var/log
    labels:
      - traefik.enable=true
      - "traefik.frontend.rule=Host:doku.YOUR-WEBSITE.com"

#NextCloud
  nextcloud:
    container_name: nextcloud
    image: nextcloud
    restart: always
    networks:
      - srv
    ports:
      - 8081:80
    depends_on:
      - db
    volumes:
      - /apps/nextcloud/:/var/www/html
    labels:
      - traefik.enable=true
      - "traefik.frontend.rule=Host:cloud.YOUR-WEBSITE.com"

  db:
    container_name: nextcloud-db
    image: mariadb
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    restart: always
    networks:
      - srv    
    volumes:
      - /apps/nextclouddb:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=CHANGEME
      - MYSQL_PASSWORD=CHANGEME
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud

networks:
   srv:
